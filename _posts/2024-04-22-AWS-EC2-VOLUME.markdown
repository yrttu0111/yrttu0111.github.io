---
layout: post
title: AWS EC2 storage
subtitle: AWS EC2 스토리지
categories: AWS
tags: [AWS, ASS, EC2, storage]
date: 2023-04-22
---

얍!

# ec2 storage

## EBS Volume

Elastic Block Store
인스턴스가 실행 중인 동안 연결이 가능한 네트워크 드라이브
EBS볼륨은 인스턴스가 종료된 후에도 지속할 수 있다.

이전 EBS볼륨을 다시 마운트하면 데이터를 다시 받을수 있다.
CCP 레벨의 EBS 볼륨은 (CCP 레벨: 하나의 EBS는 하나의 EC2 인스턴스에만 마운트 가능 / 어소시에이트 레벨: 일부 EBS 다중 연결)

한번에 하나의 인스턴스에만 마운트 할 수 있음.

EBS는 특정 가용 영역에서만 가능

네트워크를 통해 연결되는 USB 라고 생각하면 쉽다.

프리티어: 30GB FREE
범용 SSD 혹은 마그네틱 유형으로제공

물리적 드라이브가 아니라 서로 통신을 하기 위해선 네트워크를 필요로해
컴퓨터가 다른 서버에 도달할 때
지연이 생길 수 있다.

스냅샷을 이용해 다른 AZ로 볼륨을 옮길 수 있다.

미리 용량을 결정해놔야한다.
나중에 용량을 늘릴 수도 있다.

하나의 인스턴스에 2개의 볼륨을 연결 가능하다.

### EBS - DELETE ON TERMINATION ATTRIBUTE

인스턴스 종료와 함께 삭제되록 설정 할 수 있다.

## EBS SNAPSHOT

특정 시점에 대한 백업

EC2에서 EBS 볼륨을 분리할 필요는 없지만 권장 사항이다.
다른 가용영역이나 다른 리전에도 복사 할 수 있다.

### EBS SNAPSHOT ARCHIVE

최대 75% 까지 저렴한 아카이브 티어로
스냅샷을 옮길 수 있는 기능
스냅샷을 아카이브 티어로 옮기면
아카이브를 복원하는 데 24시간에서
최대 72시간이 걸림

### RECYCLE BIN FOR EBS SNAPSHOW

스냅샷 휴지통은
스냅샷을 영구 삭제하는 대신에 휴지통에 넣을 수 있다.

실수로 삭제하는 경우에
휴지통을 복원 할 수 있다.
휴지통에 보관되는 기간은 1일에서 1년 사이로 설정할 수 있다.

### FAST SNAPSHOT RESTORE (FSR)

스냅샷을 완전 초기화해 첫 사용에서의
지연시간을 없애는 기능.
스냅샷이 아주 크고 EBS 볼륨 또는 인스턴스를 빠르게 초기화 해야 할 때 특히 유용
하지만 비용이 많이 든다

## AMI (AMAZON MACHINE IMAGE)

AMI 인스턴스를 통해 만든 이미지를 통칭.
AMI로 AWS를 구축할 수도 있고, 원하는 대로 변경할 수도 있다.
AMI에 원하는 소프트웨어 또는 설정 파일을 추가하거나 별도의 운영 체제를 설치 할 수 있고 모니터링 툴을 추가할 수도 있다.

AMI를 따로 구성하면 미리 패키징해 부팅 및 설정에 드는 시간을 줄일 수 있다.

AMI를 특정 지역에 구축한 다음 다른 지역으로 복사해서 AWS의 글로벌 인프라를 활용할 수 있다.

EC2 인스턴스를 여러 종류의 AMI에서 실행 할 수 있다.

AWS에서 제공하는 기본적인 PUBLIC AMI들이 있다 예를들어 아마존 리눅스2
UBUNTU 등 있다.

다른 사람이 구축한 이미지를 구매할 수도 있다.

## EC2 INSTANCE STORE

EC2는 가상 머신이지만
실제 물리적 하드웨어가 서버에 연결되어있다.
이와 같은 서버에는 해당 서버에 물리적으로 연결된 디스크 공간을 갖는다.
이러한 특정 유형의 EC2 인스턴스는 EC2 인스턴스 스토어라고 불린다.
이는 해당 물리적 서버에 연결된 하드웨어 드라이브를 가리킨다.

I/O 성능 향상을 위해 활용 될 수 있다.
디스크 성능이 필요할 때 사용 할 수 있다.

EC2 인스턴스 중지 또는 정지시 데이터가 손실 된다.

버퍼나 캐시 스크래치 데이터 또는
임시 콘탠츠를 사용하는 경우
보관하기 좋지만 장기적인 스토리지는 될 수 없다.
서버장애가 발생할때 데이터를 백업이나 복제해 둬야한다.

## EBS VOLUME TYPES

### GP2 / GP3 (SSD)

범용 SSD 볼륨으로
다양한 워크로드에 대해 가격과 성능의 절충안

### IO 1 / IO2

최고 성능을 자랑 하는 SSD 볼륨
미션 크리티컬이자 지연 시간이 낮고
대용량에 워크로드에 쓰임

### ST1 SC1

부팅 볼륨일 수 없다.
최대 16TB까지 확장 가능

#### ST1

저비용의 HDD 볼륨
잦은 접근과 많은 워크로드에 쓰임

ST1은 처리량 최적화 HDD로 빅 데이터나 데이터 웨어하우징 로그에 적합하다.
최대 처리량은 500MB에 최대 500IOPS 이다.

#### SC1

가장 저렴한 HDD 볼륨
낮은 접근빈도와 워크로드를 위해

SC1인 콜드 HDD가 있다.
아카이브 데이터용으로 적합 최저 비용으로 데이터를 저장할 때 적합
최대 처리량은 250MB 250IOPS

### EBS 볼륨 설정

크기, 처리량, IOPS(초당 I/O수)
등의 요소가 있을 수 있다.

EC2인스턴스에는 GP2/GP3와 IO1/IO2만이 부팅 볼륨으로 사용될 수 있다.
루트 OS가 실행될 위치

### GP2와 IOPS 프로비저닝

GP2는 짧은 지연 시간을 갖음
비용도 효율적임
시스템 부팅 볼륨에서
가상 데스크톱, 개발, 테스트 환경에서 사용 가능
크기는 1GB 부터 16TB 까지 다양
2와 3의 차이는
GP3가 최신 세대이고 기본 성능이 3000IOPS와 초당125MB의 처리량 제공
또 IOP는 16000 처리량은 1000MB 까지 증가시킬 수 있다.

GP2는 오래된 버전으로 볼륨이 작다.
최대 3000IOPS에 볼륨과 IOPS가 연결되어있어 IOPS와 볼륨의 GB가 같이 늘어난다.

### 프로비저닝

IOPS 성능을 유지할 필요가 있는 주요 어플리케이션이나 16000이상의 IOPS 성능이 필요한 경우
일반적으로 데이터베이스 워크로드에 알맞다.
GP2 GP3에서 IO1,IO2로 볼륨을 변경하는 것

NITRO EC2 인스턴스에서는 최대 64000까지 가능하다.
NITRO 가 아닌 경우 최대 32000 까지 지원한다.
IO1/IO2를 이용하면 GP3 처럼 스토리지 크기와 IOPS를 독자적으로 증가 시킬 수 있다.
IO2의 장점은
1과 동일한 비용으로 내구성과 기가당 IOPS가 더 높다
IO2가 더 합리적이다.
IO2 블록 익스프레스는 4GB에서 64TB 까지 가능하며 더 고성능 유형의 볼륨이다.
지연시간이 밀리초 미만이다

## EBS 다중 연결

하나의 EBS 볼륨을 같은 가용 영역에 있는 여러 EC2 인스턴스에 연결할 수 있게 해준다. IO시리즈 만 가능하다.

다중 연결이 활성화된 IO2 볼륨이 있을때
여러개의 EC2인스턴스에 동시에 연결 가능하다.
각 인스턴스는 고성능 볼륨에 대한 읽기 및 쓰기 권한을 전부 갖는다. 동시 사용이 가능하다.

최대 16개의 인스턴스만 연결 할 수 있다.

## EBS ENCRYPTION 암호화

저장 데이터가 볼륨 내부에 암호회 되고
인스턴스와 볼륨간의 데이터 역시 암호화 된다.
스냅샷 뿐만 아니라 스냅샷으로 생성한 볼륨 역시 모두 암호화 된다.
이때 암호화 및 복호화 메커니즘은 보이지 않게 처리되고 아무것도 하지 않아도 백그라운드에서 EC2와 EBS가 모두 처리해 준다.
종합적으로 봤을 때 암호화를 사용해야하는 이유는 지연시간에 영향이 거의 없고
KMS에서 암호화 키를 생성해 AES-256 암호화 표준을 갖는다.

EBS 스냅샷 생성하고 복사기능을 통해 EBS 스냅샷을 암호화 한다.
스냅샷을 이용해 새 EBS 볼륨을 생성하면 해당 볼륨도 암호화 된다.
암호화된 볼륨도 암호화된다.
암호화된 볼륨을 인스턴스 원본에 연결

## AMAZON EFS - ELASTIC FILE SYSTEM

EFS는 관리형 NFS(네트워크 파일 시스템)
네트워크 파일 시스템이므로 많은 EC2 인스턴스에 마운트 될 수 있다.
EC2 인스턴스는 서로 다른 가용 영역에 있을 수도 있다.

가용성이 높고 확장성이 뛰어나다.
단점은 비싸다. GP2 EBS볼륨의 약 3배
사용량에 따라 비용을 지불하므로 미리 용량을 프로비저닝 할 필요가 없다.

EFS는 콘텐츠 관리, 웹 서빙, 데이터 공유, WORDPRESS등에 사용된다.
내부적으로 NFS 프로토콜을 사용하며, EFS에 대한 액세스를 제어하려면 보안 그룹을 설정해야 한다.
LINUX기반 AMI만 호환된다.

KMS를 사용해 EFS드라이브에서 미사용 암호화를 활성화 할 수 있다.
LINUX 표준 파일 시스템

따라서 POSIX 시스템 사용
그리고 표준 파일 API가 있다.
EFS는 용량을 미리 계획할 필요가 없다.
자동 확장 되고 GB 사용량에 따라 지불

### 성능 및 스토리지 클래스

EFS 스케일은 동시 NFS 클라이언트 수천 개와 10GB 이상의 처리량을 확보 가능하다.
PB 규모의 네트워크 파일 시스템으로 자동확장 할 수 있다.
또한 네트워크 파일 시스템 생성 시 성능 모드를 설정할 수 있다.

### 범용 General Purpose (DEFAULT)

지연시간에 민감한 사용에 적합 웹서버나 CMS 같은 것.

### 최대 IO 모드 MAX I/O

처리량을 최대화 지연시간이 더길지만
처리량이 높고 병렬성이 높다.
빅 데이터 애플리 케이션이나 미디어 처리가 필요한경우 유용하다.

처리량 모드에서 다양한 옵션이 있다.

1. 버스팅 - 1TB로 초당 50MIB에 초당 100MIB 버스트 까지 더함
2. 프로 비저닝 - 스토리지 크기에 관계없이 처리량을 설정 하고 싶은 경우
   1TB의 스토리지에서 1GIB를 처리할 수있다.
   스토리지와 처리량을 분리했다.
3. 엘라스틱 옵션 - 워크로드에 따라 처리량을 자동으로 조절할 수 있다.
   예를 들어, 읽기능 초당 최대 3GIB, 쓰시는 초당 1GIB까지 워크로드에 따라 가능하다. 워크로드를 예측하기 어려울 때 유용

### 스토리지 클래스

스토리지 계층을 설정할 수 있다.
며칠 후 파일을 다른 계층으로 옮길 수 있는 기능
예를 들어 표준 계층은 자주 액세스하는 파일을 위한 계층이고, 자주 액세스하지 않는 계층은 EFS-IA인데, 이 계층은 파일을 검색할 경우 비용이 발생한다.
하지만 파일을 EFS-IA에 저장하면 비용이 감수 된다.
EFS-IA를 사용하려면 수명 주기 정책을 사용해야 한다.
자주 사용하지 않는 파일을 EFS표준에서 EFS-IA 계층으로 이동시켜 비용을 절감한다.

가용성과 내구성
다중 AZ로 EFS를 설정하면
가용성 영역은 하나가 다운되더라도 EFS파일 시스템에 영향을 미치지 않는다.
프로덕션사용으로 좋다.

개발용으로는 ONE ZONE EFS 파일 시스템을 사용할 수 있다.
개발엔 좋지만 하나의 AZ에만 있고 백업은 기본적으로 활성화 되도록 설정 되어 있으며 액세스 빈도가 낮은 스토리지 계층과 호환된다
따라서 ONE ZONE IA라고 불리며 이를 사용하면 약 90%의 할인을 받을수 있다.

## EBS vs EFS

EBS는 한 번에 하나의 인스턴스에 첨부, io1,io2 유형 볼륨은 다중 첨부 기능을 사용하지만 특별한 사용 사례다.
같은 AZ수준에서 사용 할 수 있다.
ebs는 AZ간의 이동을 하려면 스냅샷을 기록하고 다른 AZ로 복사해 이동해야한다.
EBS 볼륨 백업은 IO를 사용하므로, 애플리케이션이 많은 트레픽을 처리하는 경우엔 실행하지 않아야 한다. ec2 인스턴스의 성능에 영향을 미칠 수 있다.
인스턴스의 루트 EBS 볼륨은 ec2 인스턴스가 종료되면 기본적으로 종료 된다.(비활성화 가능)

EFS의 경우 네트워크 파일 시스템이며
목표는 여러 가용성 영역에 걸친 수백개의 인스턴스에 첨부 한다.
